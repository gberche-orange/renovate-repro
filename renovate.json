{
  "$schema": "https://docs.renovatebot.com/renovate-schema.json",
  "extends": [
    "config:base",
    ":disableRateLimiting"
  ],

  "ignorePaths": [
    "**/terraform-config/**",
    "vendor/k8s-manifests/**",
    "submodules/**",
    "master-depls/**/k8s-config/manifests/**/test-cases/**"
  ],
  "flux": {
    "fileMatch": [
      "shared-operators/k8s-kustomize-bases/helm/.+/.+\\.yaml$",
      "shared-operators/k8s-kustomize-bases/00-common/fluxcd",
      ".+/.+/k8s-config/manifests/.+\\.yaml$"
    ]
  },
  "kubernetes": {
    "fileMatch": [
      "shared-operators/k8s-kustomize-bases/.+\\.yaml$",
      ".+/.+/k8s-config/manifests/.+\\.yaml$"
    ],
    "ignorePaths": [
      "shared-operators/k8s-kustomize-bases/services/redis-binding/redis-binding-formatter-helm-chart"
    ]
  },
  "packageRules": [
    {
      "matchDatasources": ["helm"],
      "matchPackageNames": ["ingress-nginx"],
      "versioning": "pep440"
    },
    {
      "matchDatasources": ["helm"],
      "matchPackageNames": [
        "redis"
      ],
      "assignees": [
        "gberche-orange"
      ],
      "description": "prBodyNotes adds additional text. Alternative it customChangeLogUrl when parseable",
      "prBodyNotes": ["Additional changelog at https://github.com/bitnami/charts/blob/master/bitnami/redis/README.md#upgrading"]
    },
    {
      "description": "PR assignee per package. TODO: expand to team",
      "matchDatasources": ["github-tags"],
      "matchPackageNames": [
        "pivotal-cf/shared-redis-release"
      ],
      "assignees": [
        "JCL38-ORANGE"
      ]
    },
    {
      "description": "Tune versioning to avoid PR proposing v1.1.1 instead of 1.1.1",
      "matchDatasources": ["docker"],
      "matchPackageNames": [
        "boshprometheus/bosh-exporter",
        "boynux/squid-exporter",
        "envoyproxy/envoy",
        "niedbalski/openstack-exporter-linux-amd64",
        "pryorda/vmware_exporter",
        "thanosio/thanos"
      ],
      "versioning": "regex:v?(?<major>\\d+)\\.(?<minor>\\d+)\\.(?<patch>\\d+)?$"
    },
    {
      "matchDatasources": ["docker"],
      "addLabels": ["docker"]
    },
    {
      "matchPackagePrefixes": ["confluentinc/ksqldb-"],
      "customChangelogUrl": "https://github.com/confluentinc/ksql"
    },
    {
      "matchDatasources": ["rubygems"],
      "addLabels": ["rubygems"]
    },
    {
      "matchDatasources": ["ruby-version"],
      "addLabels": ["ruby-version"]
    },
    {
      "matchDatasources": ["helm"],
      "addLabels": ["helm"]
    },
    {
      "matchDatasources": ["terraform-provider"],
      "addLabels": ["terraform-provider"]
    },
    {
      "matchManagers": ["regex"],
      "matchPaths": ["root-deployment.yml"],
      "addLabels": ["bosh-release"]
    },
    {
      "matchDatasources": ["github-releases"],
      "matchManagers": ["regex"],
      "matchPaths": ["vendir-k8s-manifest.yml"],
      "addLabels": ["vendir", "github-release"]
    },
    {
      "matchDatasources": ["github-tags"],
      "matchManagers": ["regex"],
      "matchPaths": ["vendir-k8s-manifest.yml"],
      "addLabels": ["vendir", "github-tags"]
    }
  ],

  "regexManagers": [
    {
      "fileMatch": ["shared-operators/docker-images/docker-images-versions-vars\\.yml$"],
      "matchStrings": [
        "(?<depName>[a-z0-9/\\-_]*?): \"(?<currentValue>[a-z0-9\\.\\-]*?)\"\\nn"
      ],
      "datasourceTemplate": "docker",
      "versioningTemplate": "docker"
    },
    {
      "description": "https://regex101.com/r/Fshep2/1",
      "fileMatch": ["master-depls/00-supervision/k8s-config/manifests/20-kafka-ksqldb-bi/cp-ksql-server-helm-release-patch\\.yaml$"],
      "matchStrings": [
        "  +image: (?<depName>[a-z0-9\\.\\/\\-]*?)\\n +imageTag: (?<currentValue>[a-z0-9\\.\\/\\-\\+]*?) *\\n"
      ],
      "datasourceTemplate": "docker",
      "versioningTemplate": "docker"
    },
    {
      "description": "root-deployment is coa management of bosh released hosted in bosh.io from git tags. Not using github-releases ",
      "fileMatch": [".+/root-deployment\\.yml$"],
      "matchStrings": [
        "( +comments:.*\\n( {6}.*\\n)+)? +repository: (?<depName>[a-z0-9/-]*?)\\n( +sha1: .*\\n)?( +skip_branch_checkout: .*\\n)?( +tag_prefix: (?<tagPrefix>.*)\\n)? +version: '?(?<currentValue>[a-zA-Z0-9\\.\\-]*?)'?\\n"
      ],
      "datasourceTemplate": "github-tags",
      "versioningTemplate": "loose",
      "extractVersionTemplate": "{{#if tagPrefix}}(?<version>.*){{else}}^v(?<version>.*){{/if}}"
    },
    {
      "description": "https://regex101.com/r/ms9hZL/1",
      "fileMatch": ["vendor/vendir-k8s-manifest.yml$"],
      "matchStrings": [
        " +githubRelease:\\n +slug: (?<depName>[a-z0-9\\.\\/\\-]*?)\\n +tag: (?<currentValue>[a-z0-9\\.\\/\\-\\+]*?) *\\n"
      ],
      "datasourceTemplate": "github-releases",
      "versioningTemplate": "regex:v?(?<major>\\d+)\\.(?<minor>\\d+)\\.(?<patch>\\d+)?$"
    },
    {
      "description": "https://regex101.com/r/boCv4J/1",
      "fileMatch": ["vendor/vendir-k8s-manifest.yml$"],
      "matchStrings": [
        " +git:\\n +url: https:\\/\\/github\\.com\\/(?<depName>[a-z0-9\\.\\/\\-:]*?)\\n +ref: (?<currentValue>[a-z0-9\\.\\/\\-\\+]*?) *\\n"
      ],
      "datasourceTemplate": "github-tags",
      "versioningTemplate": "regex:v?(?<major>\\d+)\\.(?<minor>\\d+)\\.(?<patch>\\d+)?$"
    }
  ]

}



